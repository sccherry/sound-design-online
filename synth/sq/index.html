<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>[SQ] Sequence | Sound Design Online</title>
    <meta name="description" content="Creating Sounds for Electronic Music using web audio." />

    <link rel="icon" href="/sound-design-online/public/img/favicon.ico" size="any" />
    <link
      rel="icon"
      href="/sound-design-online/public/img/icon.svg"
      type="image/svg+xml"
    />
    <link
      rel="apple-touch-icon"
      href="/sound-design-online/public/img/apple-touch-icon.png"
    />

    <link rel="canonical" href="https://stevecherry.net/sound-design-online/synth/sq/" />

    <link
      rel="stylesheet"
      href="https://stevecherry.net/normcore/css/normcore.css"
    />
    <link rel="stylesheet" href="/sound-design-online/public/style.css" media="screen" />

    <script
      src="https://stevecherry.net/normcore/js/normcore.js"
      defer
    ></script>
    <script src="/sound-design-online/public/script.js" type="module"></script>
  </head>
  <body>
    <div class="container cover stack">
      <header role="banner">
        <a href="/sound-design-online/">Sound Design Online</a>
      </header>

      <main class="flex-auto stack" role="main">
        <h1>[SQ] Sequence</h1>

        



<div class="grid">
  
  
  

  
      <fieldset id="synth-oscillator">
        <legend>Oscillator</legend>
        
    
  
      <label for="synth-oscillator-type">Type</label>
      
    <select id="synth-oscillator-type" name="synth-oscillator-type" value="sawtooth">
      
        <option value="sine">sine</option>
      
        <option value="triangle">triangle</option>
      
        <option value="square">square</option>
      
        <option value="sawtooth" selected>sawtooth</option>
      
    </select>
  
    

    
    
  
  
  
  
  

  
      <fieldset id="synth-oscillator-detune">
        <legend>Detune</legend>
        
    
  
      <label for="synth-oscillator-detune-octave">Octave</label>
      
    <input type="range" id="synth-oscillator-detune-octave" name="synth-oscillator-detune-octave" min="-3600" max="3600" step="1200" value="0">
    <output for="synth-oscillator-detune-octave">0</output>
  
    

    
  
      <label for="synth-oscillator-detune-coarse">Coarse</label>
      
    <input type="range" id="synth-oscillator-detune-coarse" name="synth-oscillator-detune-coarse" min="-1200" max="1200" step="100" value="0">
    <output for="synth-oscillator-detune-coarse">0</output>
  
    

    
  
      <label for="synth-oscillator-detune-fine">Fine</label>
      
    <input type="range" id="synth-oscillator-detune-fine" name="synth-oscillator-detune-fine" min="-100" max="100" step="1" value="0">
    <output for="synth-oscillator-detune-fine">0</output>
  
    

  
      </fieldset>
    

    
  
      <label for="synth-oscillator-phase">Phase</label>
      
    <input type="range" id="synth-oscillator-phase" name="synth-oscillator-phase" min="-180" max="180" step="1" value="0">
    <output for="synth-oscillator-phase">0</output>
  
    

  
      </fieldset>
    

  
  
      <fieldset id="synth-envelope">
        <legend>Envelope</legend>
        
    
  
      <fieldset id="synth-envelope-envelope">
        <legend>Envelope</legend>
        
    
  
      <label for="synth-envelope-envelope-attack">Attack</label>
      
    <input type="range" id="synth-envelope-envelope-attack" name="synth-envelope-envelope-attack" min="0" max="1" step="0.001" value="0.01">
    <output for="synth-envelope-envelope-attack">0.01</output>
  
    

    
  
      <label for="synth-envelope-envelope-decay">Decay</label>
      
    <input type="range" id="synth-envelope-envelope-decay" name="synth-envelope-envelope-decay" min="0" max="1" step="0.001" value="0.8">
    <output for="synth-envelope-envelope-decay">0.8</output>
  
    

    
  
      <label for="synth-envelope-envelope-sustain">Sustain</label>
      
    <input type="range" id="synth-envelope-envelope-sustain" name="synth-envelope-envelope-sustain" min="0" max="1" step="0.001" value="0">
    <output for="synth-envelope-envelope-sustain">0</output>
  
    

    
  
      <label for="synth-envelope-envelope-release">Release</label>
      
    <input type="range" id="synth-envelope-envelope-release" name="synth-envelope-envelope-release" min="0" max="1" step="0.001" value="0.02">
    <output for="synth-envelope-envelope-release">0.02</output>
  
    

  
      </fieldset>
    

  
      </fieldset>
    

  
  
      <fieldset id="synth-filter">
        <legend>Filter</legend>
        
    
  
      <label for="synth-filter-type">Type</label>
      
    <select id="synth-filter-type" name="synth-filter-type" value="lowpass">
      
        <option value="lowpass" selected>lowpass</option>
      
        <option value="highpass">highpass</option>
      
        <option value="bandpass">bandpass</option>
      
        <option value="lowshelf">lowshelf</option>
      
        <option value="highshelf">highshelf</option>
      
        <option value="notch">notch</option>
      
        <option value="allpass">allpass</option>
      
        <option value="peaking">peaking</option>
      
    </select>
  
    

    
  
      <label for="synth-filter-rolloff">Rolloff</label>
      
    <select id="synth-filter-rolloff" name="synth-filter-rolloff" value="-12">
      
        <option value="-12" selected>-12</option>
      
        <option value="-24">-24</option>
      
        <option value="-48">-48</option>
      
        <option value="-96">-96</option>
      
    </select>
  
    

    
  
      <label for="synth-filter-frequency">Frequency</label>
      
    <input type="range" id="synth-filter-frequency" name="synth-filter-frequency" min="10" max="24000" step="1" value="350">
    <output for="synth-filter-frequency">350</output>
  
    

    
  
      <label for="synth-filter-q">Q</label>
      
    <input type="range" id="synth-filter-q" name="synth-filter-q" min="1" max="8" step="1" value="1">
    <output for="synth-filter-q">1</output>
  
    

  
      </fieldset>
    

  
  
      <fieldset id="synth-filter-envelope">
        <legend>Filter envelope</legend>
        
    
  
      <fieldset id="synth-filter-envelope-envelope">
        <legend>Envelope</legend>
        
    
  
      <label for="synth-filter-envelope-envelope-attack">Attack</label>
      
    <input type="range" id="synth-filter-envelope-envelope-attack" name="synth-filter-envelope-envelope-attack" min="0" max="3" step="0.001" value="0.01">
    <output for="synth-filter-envelope-envelope-attack">0.01</output>
  
    

    
  
      <label for="synth-filter-envelope-envelope-decay">Decay</label>
      
    <input type="range" id="synth-filter-envelope-envelope-decay" name="synth-filter-envelope-envelope-decay" min="0" max="3" step="0.001" value="0.8">
    <output for="synth-filter-envelope-envelope-decay">0.8</output>
  
    

    
  
      <label for="synth-filter-envelope-envelope-sustain">Sustain</label>
      
    <input type="range" id="synth-filter-envelope-envelope-sustain" name="synth-filter-envelope-envelope-sustain" min="0" max="3" step="0.001" value="0">
    <output for="synth-filter-envelope-envelope-sustain">0</output>
  
    

    
  
      <label for="synth-filter-envelope-envelope-release">Release</label>
      
    <input type="range" id="synth-filter-envelope-envelope-release" name="synth-filter-envelope-envelope-release" min="0" max="3" step="0.001" value="0.02">
    <output for="synth-filter-envelope-envelope-release">0.02</output>
  
    

  
      </fieldset>
    

    
  
      <label for="synth-filter-envelope-base-frequency">Base frequency</label>
      
    <input type="range" id="synth-filter-envelope-base-frequency" name="synth-filter-envelope-base-frequency" min="10" max="24000" step="1" value="200">
    <output for="synth-filter-envelope-base-frequency">200</output>
  
    

    
  
      <label for="synth-filter-envelope-octaves">Octaves</label>
      
    <input type="range" id="synth-filter-envelope-octaves" name="synth-filter-envelope-octaves" min="1" max="20" step="1" value="0">
    <output for="synth-filter-envelope-octaves">0</output>
  
    

    
  
      <label for="synth-filter-envelope-exponent">Exponent</label>
      
    <input type="range" id="synth-filter-envelope-exponent" name="synth-filter-envelope-exponent" min="1" max="5" step="1" value="1">
    <output for="synth-filter-envelope-exponent">1</output>
  
    

  
      </fieldset>
    

  
  
      <fieldset id="lfo">
        <legend>LFO</legend>
        
    
  
      <label for="lfo-frequency">Frequency</label>
      
    <select id="lfo-frequency" name="lfo-frequency" value="1n">
      
        <option value="4n">4n</option>
      
        <option value="8n">8n</option>
      
        <option value="16n">16n</option>
      
    </select>
  
    

    
  
      <label for="lfo-type">Type</label>
      
    <select id="lfo-type" name="lfo-type" value="sawtooth">
      
        <option value="sine">sine</option>
      
        <option value="triangle">triangle</option>
      
        <option value="square">square</option>
      
        <option value="sawtooth" selected>sawtooth</option>
      
    </select>
  
    

    
  
      <label for="lfo-min">Min</label>
      
    <input type="range" id="lfo-min" name="lfo-min" min="1" max="20" step="1" value="100">
    <output for="lfo-min">100</output>
  
    

    
  
      <label for="lfo-max">Max</label>
      
    <input type="range" id="lfo-max" name="lfo-max" min="1" max="20" step="1" value="2000">
    <output for="lfo-max">2000</output>
  
    

  
      </fieldset>
    

  
  
      <fieldset id="loop">
        <legend>Loop</legend>
        
    
  
      <label for="loop-interval">Interval</label>
      
    <select id="loop-interval" name="loop-interval" value="8n">
      
        <option value="4n">4n</option>
      
        <option value="8n" selected>8n</option>
      
        <option value="16n">16n</option>
      
    </select>
  
    

  
      </fieldset>
    

  
  
      <fieldset id="transport">
        <legend>Transport</legend>
        
    
  
      <label for="transport-bpm">BPM</label>
      
    <input type="range" id="transport-bpm" name="transport-bpm" min="60" max="220" step="1" value="120">
    <output for="transport-bpm">120</output>
  
    

    
  <label for="transport-state">
    <input type="checkbox" id="transport-state" name="transport-state"  checked>
    State
  </label>

  
      </fieldset>
    

</div>


  
  
      <label for="piano-mode">Mode</label>
      
    <select id="piano-mode" name="piano-mode" value="toggle">
      
        <option value="button">button</option>
      
        <option value="toggle" selected>toggle</option>
      
        <option value="impulse">impulse</option>
      
    </select>
  
    

  <div id="piano-piano"></div>


<script type="module">
  import { LFO, Loop, Midi, MonoSynth, PolySynth, Transport, start } from 'https://cdn.skypack.dev/tone';
  import { createAmplitudeEnvelope, createFilter, createFrequencyEnvelope, createLfo, createLoop, createOmniOscillator, createPiano, createTransport } from '../../public/lib/nexus-tone-components.js';

  const options = {"synth":{"oscillator":{"type":"sawtooth"},"envelope":{"decay":0.8,"sustain":0,"release":0.02},"filter":{"rolloff":-12},"filterEnvelope":{"octaves":0,"decay":0.8,"sustain":0,"release":0.02}},"loop":{"interval":"8n"},"lfo":{"frequency":"1n","min":100,"max":2000,"type":"sawtooth"},"transport":{"state":true}};

  const lfo = new LFO(options.lfo);

  class SequencedPolySynth extends PolySynth {
    _getNextAvailableVoice() {
      // if there are available voices, return the first one
      if (this._availableVoices.length) {
        return this._availableVoices.shift();
      } else if (this._voices.length < this.maxPolyphony) {
        // otherwise if there is still more maxPolyphony, make a new voice
        const voice = new this.voice(
          Object.assign(this.options, {
            context: this.context,
            onsilence: this._makeVoiceAvailable.bind(this),
          })
        );
        voice.connect(this.output);
        this._voices.push(voice);
        lfo.connect(voice.filter.frequency);
        return voice;
      } else {
        warn('Max polyphony exceeded. Note dropped.');
      }
    }
  }

  const synth = new SequencedPolySynth(MonoSynth, { maxPolyphony: 4, ...options.synth });

  synth.toDestination();

  lfo.sync().start();

  if (options.transport.bpm) {
    Transport.bpm.value = options.transport.bpm;
  }

  const voices = new Set();

  const loop = new Loop(time => {
    if (voices.size > 0) {
      const freqs = Array.from(voices).map(note => Midi(note).toFrequency());
      synth.triggerAttackRelease(freqs, '1n', time);
    }
  }, options.loop.interval).start();

  const onMidi = ([status, data0, data1]) => {
    const message = Math.floor(status / 16);
    const channel = status % 16;

    switch (message) {
      // note on
      case 9: {
        voices.add(data0);
        break;
      }
      // note off
      case 8: {
        voices.delete(data0);
        break;
      }
    }
  };

  createOmniOscillator('#synth-oscillator', value => {
    synth.set({ oscillator: value });
  });

  createAmplitudeEnvelope('#synth-envelope', value => {
    synth.set({ envelope: value });
  });

  createFilter('#synth-filter', value => {
    synth.set({ filter: value });
  });

  createFrequencyEnvelope('#synth-filter-envelope', value => {
    synth.set({ filterEnvelope: value });
  });

  createLoop('#loop', value => {
    loop.set(value);
  });

  createLfo('#lfo', value => {
    lfo.set(value);
  });

  createTransport('#transport', value => {
    Object.keys(value).forEach(key => {
      switch (key) {
        case 'bpm': {
          Transport.bpm.value = value[key];
          break;
        }
        case 'state': {
          if (value[key]) {
            Transport.start();
          } else {
            Transport.stop();
          }
        }
      }
    });
  });

  createPiano('#piano', onMidi);

  document.addEventListener('click', async () => {
    await start();

    if (options.transport.state) {
      Transport.start();
    }

    console.log('audio context resumed');
  }, { once: true });
</script>

      </main>

      <footer role="contentinfo">
        <p>Creating Sounds for Electronic Music using web audio.</p>
      </footer>
    </div>
  </body>
</html>
